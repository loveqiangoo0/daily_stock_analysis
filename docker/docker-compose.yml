# ===================================
# A股自选股智能分析系统 - Docker Compose
# ===================================
# 
# 使用方式:
#   定时模式: docker-compose -f ./docker/docker-compose.yml up -d

version: '3.8'

x-common: &common
  build:
    context: ..
    dockerfile: docker/Dockerfile
  restart: unless-stopped

  # 环境变量（从 .env 文件加载）
  env_file:
    - ../.env

  volumes:
    - ../data:/app/data
    - ../logs:/app/logs
    - ../reports:/app/reports
    - ../.env:/app/.env

  environment:
    - TZ=Asia/Shanghai

    # 代理设置（如果需要）
    # - http_proxy=http://host.docker.internal:10809
    # - https_proxy=http://host.docker.internal:10809
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
  # 资源限制
  deploy:
    resources:
      limits:
        memory: 512M
      reservations:
        memory: 256M

services:
  # 定时任务模式
  analyzer:
    <<: *common
    container_name: stock-analyzer
